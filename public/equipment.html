<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- ========================
         Enhanced SEO Meta Tags
         ======================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Primary Meta Tags -->
    <title>設備一覧 | O.N.Precision - 精密切削加工</title>
    <meta name="title" content="設備一覧 | O.N.Precision - 精密切削加工">
    <meta name="description" content="O.N.Precisionの設備一覧。NC自動旋盤、複合旋盤、各種検査機器を完備。高精度加工を実現する最新設備をご紹介。">
    <meta name="keywords" content="設備一覧, NC自動旋盤, CNC加工, 検査設備, 精密加工, O.N.Precision">
    <meta name="author" content="O.N.Precision">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

    <!-- Theme Color -->
    <meta name="theme-color" content="#8b1a1a">
    <meta name="msapplication-TileColor" content="#8b1a1a">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.onprecision.com/equipment.html">

    <!-- Language Alternates -->
    <link rel="alternate" hreflang="ja" href="https://www.onprecision.com/equipment.html">
    <link rel="alternate" hreflang="en" href="https://www.onprecision.com/equipment.html?lang=en">
    <link rel="alternate" hreflang="vi" href="https://www.onprecision.com/equipment.html?lang=vi">
    <link rel="alternate" hreflang="x-default" href="https://www.onprecision.com/equipment.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="O.N.Precision">
    <meta property="og:url" content="https://www.onprecision.com/equipment.html">
    <meta property="og:title" content="設備一覧 | O.N.Precision">
    <meta property="og:description" content="NC自動旋盤、複合旋盤、各種検査機器を完備。高精度加工を実現する最新設備">
    <meta property="og:image" content="https://www.onprecision.com/assets/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="ja_JP">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:locale:alternate" content="vi_VN">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@O.N.Precision">
    <meta name="twitter:title" content="設備一覧 | O.N.Precision">
    <meta name="twitter:description" content="NC自動旋盤、複合旋盤、各種検査機器を完備">
    <meta name="twitter:image" content="https://www.onprecision.com/assets/images/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/images/apple-touch-icon.png">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Main CSS -->
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/works.css">
    <link rel="stylesheet" href="./assets/css/equipment.css">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://www.onprecision.com/"},
            {"@type": "ListItem", "position": 2, "name": "設備一覧", "item": "https://www.onprecision.com/equipment.html"}
        ]
    }
    </script>
</head>


<body>
    <!-- ========================
         Header / Navigation
         ======================== -->
    <header class="header" id="header">
        <div class="header-container">
            <!-- Logo -->
            <a href="./index.html" class="logo" aria-label="O.N.Precision ??????">
                <svg class="logo-icon" viewBox="0 0 40 40" width="40" height="40">
                    <circle cx="20" cy="20" r="18" fill="none" stroke="#8b1a1a" stroke-width="2" />
                    <path d="M12 20 L28 20 M20 12 L20 28" stroke="#8b1a1a" stroke-width="2" />
                </svg>
                <span class="logo-text" data-i18n="company_name">O.N.Precision</span>
            </a>

            <!-- Main Navigation -->
            <nav class="main-nav" id="mainNav" aria-label="??????????">
                <ul class="nav-list">
                    <li><a href="./index.html" class="nav-link" data-i18n="nav_home">???</a></li>
                    <li><a href="./works.html" class="nav-link" data-i18n="nav_works">????</a></li>
                    <li><a href="./products.html" class="nav-link" data-i18n="nav_products">????</a></li>
                    <li><a href="./equipment.html" class="nav-link active" data-i18n="nav_equipment">????</a></li>
                    <li><a href="./company.html" class="nav-link" data-i18n="nav_about">????</a></li>
                    <li><a href="./contact.html" class="nav-link" data-i18n="nav_contact">??????</a></li>
                </ul>
            </nav>

            <!-- Language Switcher -->
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="ja" aria-label="????????">JP</button>
                <span class="lang-divider">|</span><button class="lang-btn" data-lang="en"
                    aria-label="English">EN</button><span class="lang-divider">|</span><button class="lang-btn"
                    data-lang="vi" aria-label="Chuy?n sang ti?ng Vi?t">VN</button>
            </div>

            <!-- Contact Button -->
            <a href="./contact.html" class="header-contact-btn">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                    <path d="M22 6l-10 7L2 6" />
                </svg>
                <span data-i18n="header_contact">??????</span>
            </a>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="????" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </header>

    <!-- ========================
         Page Banner
         ======================== -->
    <section class="page-banner equipment-banner">
        <div class="page-banner-bg">
            <img src="./assets/images/equipment/cnc-floor.png" alt="????" loading="eager">
            <div class="page-banner-overlay"></div>
        </div>
        <div class="page-banner-content">
            <nav class="breadcrumb" aria-label="???????">
                <a href="./index.html" data-i18n="nav_home">HOME</a>
                <span class="breadcrumb-separator">�</span>
                <span class="breadcrumb-current" data-i18n="nav_equipment">????</span>
            </nav>
            <h1 class="page-title" data-i18n="equipment_page_title">????</h1>
        </div>
    </section>

    <!-- ========================
         Equipment Main Section
         ======================== -->
    <section class="equipment-section">
        <div class="container">
            <!-- Section Header -->
            <header class="section-header">
                <h2 class="section-title">EQUIPMENT</h2>
                <p class="section-subtitle" data-i18n="equipment_subtitle">????</p>
            </header>

            <!-- Department Tabs (Dynamic from API) -->
            <div class="department-tabs" id="departmentTabs">
                <button class="dept-tab active" onclick="filterDept('all')">Loading...</button>
            </div>

            <!-- Equipment Grid: Table + Images -->
            <div class="equipment-main-grid"
                style="display:grid;grid-template-columns:1fr 350px;gap:2rem;align-items:start;">

                <!-- Left: Dynamic Equipment Table -->
                <div class="equipment-dynamic-wrapper"
                    style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
                    <table class="equipment-table" style="width:100%;">
                        <thead>
                            <tr>
                                <th data-i18n="equipment_th_name">機器名</th>
                                <th data-i18n="equipment_th_maker">メーカー・型式</th>
                                <th data-i18n="equipment_th_capacity">加工能力</th>
                                <th data-i18n="equipment_th_qty">台数</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <tr>
                                <td colspan="4" style="text-align:center;padding:2rem;color:#6b7280;">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Right: Gallery Images -->
                <div class="equipment-images-sidebar"
                    style="display:flex;flex-direction:column;gap:1rem;position:sticky;top:2rem;">
                    <div class="equipment-image-card"
                        style="border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <img src="./assets/images/equipment/lathe.png" alt="NC自動旋盤"
                            style="width:100%;height:200px;object-fit:cover;">
                        <div style="padding:0.75rem;background:#fff;text-align:center;font-weight:500;"
                            data-i18n="equipment_lathe_title">旋盤部門</div>
                    </div>
                    <div class="equipment-image-card"
                        style="border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <img src="./assets/images/equipment/grinding.png" alt="研磨機"
                            style="width:100%;height:200px;object-fit:cover;">
                        <div style="padding:0.75rem;background:#fff;text-align:center;font-weight:500;"
                            data-i18n="equipment_grinding_title">研磨部門</div>
                    </div>
                    <div class="equipment-image-card"
                        style="border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                        <img src="./assets/images/equipment/inspection.png" alt="検査機器"
                            style="width:100%;height:200px;object-fit:cover;">
                        <div style="padding:0.75rem;background:#fff;text-align:center;font-weight:500;"
                            data-i18n="equipment_inspection_title">検査部門</div>
                    </div>
                </div>
            </div>

            <style>
                @media (max-width: 1024px) {
                    .equipment-main-grid {
                        grid-template-columns: 1fr !important;
                    }

                    .equipment-images-sidebar {
                        display: grid !important;
                        grid-template-columns: repeat(3, 1fr);
                        position: static !important;
                    }
                }

                @media (max-width: 640px) {
                    .equipment-images-sidebar {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>

            <!-- Equipment Content Grid (Static Fallback) -->
            <div class="equipment-content-grid" style="display:none;">
                <!-- Tables Column -->
                <div class="equipment-tables">

                    <!-- ???? (Lathe Department) -->
                    <div class="equipment-category">
                        <h3 class="equipment-category-title" data-i18n="equipment_lathe_title">????</h3>
                        <div class="equipment-table-wrapper">
                            <table class="equipment-table">
                                <thead>
                                    <tr>
                                        <th data-i18n="equipment_th_name">???</th>
                                        <th data-i18n="equipment_th_maker">????�??</th>
                                        <th data-i18n="equipment_th_capacity">????</th>
                                        <th data-i18n="equipment_th_qty">??</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? RNC16B</td>
                                        <td>f3~f16</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? RNC16</td>
                                        <td>f3~f16</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? SA-16</td>
                                        <td>f3~f20</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? SR-16</td>
                                        <td>f3~f16</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? SR-20</td>
                                        <td>f3~f20</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? SB-16</td>
                                        <td>f3~f16</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????? SR-20</td>
                                        <td>f3~f20</td>
                                        <td>3</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????????? A-20</td>
                                        <td>f5~f20</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????????? K16E</td>
                                        <td>f4~f16</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????????? B12</td>
                                        <td>f3~f12</td>
                                        <td>9</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_nc_lathe">NC????</td>
                                        <td>????????? L12</td>
                                        <td>f3~f12</td>
                                        <td>3</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_bench_lathe">????</td>
                                        <td>???</td>
                                        <td>f10</td>
                                        <td>4</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ???? (Grinding Department) -->
                    <div class="equipment-category">
                        <h3 class="equipment-category-title" data-i18n="equipment_grinding_title">????</h3>
                        <div class="equipment-table-wrapper">
                            <table class="equipment-table">
                                <thead>
                                    <tr>
                                        <th data-i18n="equipment_th_name">???</th>
                                        <th data-i18n="equipment_th_maker">????�??</th>
                                        <th data-i18n="equipment_th_qty">??</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td data-i18n="equipment_barrel">??????</td>
                                        <td>?????</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_centrifugal">????????</td>
                                        <td>?????</td>
                                        <td>1</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ???? (Inspection Department) -->
                    <div class="equipment-category">
                        <h3 class="equipment-category-title" data-i18n="equipment_inspection_title">????</h3>
                        <div class="equipment-table-wrapper">
                            <table class="equipment-table">
                                <thead>
                                    <tr>
                                        <th data-i18n="equipment_th_name">???</th>
                                        <th data-i18n="equipment_th_maker">????�??</th>
                                        <th data-i18n="equipment_th_qty">??</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td data-i18n="equipment_tool_microscope">?????</td>
                                        <td>????</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_projector">???</td>
                                        <td>???? VP3000</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_roughness">??????</td>
                                        <td>???? SJ400</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_image_dim">?????</td>
                                        <td>????? LM-X</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_image_dim">?????</td>
                                        <td>????? IM-6500</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_image_dim">?????</td>
                                        <td>????? IM-7100</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_contour">???????</td>
                                        <td>????</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td data-i18n="equipment_roundness">??????</td>
                                        <td>????</td>
                                        <td>1</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>

                <!-- Images Column -->
                <div class="equipment-images">
                    <div class="equipment-image-item">
                        <img src="./assets/images/equipment/lathe.png" alt="NC????" loading="lazy">
                    </div>
                    <div class="equipment-image-item">
                        <img src="./assets/images/equipment/grinding.png" alt="????" loading="lazy">
                    </div>
                    <div class="equipment-image-item">
                        <img src="./assets/images/equipment/inspection.png" alt="????" loading="lazy">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================
         Factory Floor Image
         ======================== -->
    <section class="equipment-gallery">
        <div class="equipment-gallery-full">
            <img src="./assets/images/equipment/cnc-floor.png" alt="?????" loading="lazy">
        </div>
    </section>

    <!-- ========================
         Contact CTA Section
         ======================== -->
    <section class="works-cta-section">
        <div class="container">
            <div class="works-cta-grid">
                <!-- Company Info -->
                <div class="works-cta-company">
                    <p class="cta-tagline" data-i18n="cta_tagline">???????????????????????</p>
                    <div class="works-cta-logo">
                        <svg viewBox="0 0 40 40" width="40" height="40">
                            <circle cx="20" cy="20" r="18" fill="none" stroke="#8b1a1a" stroke-width="2" />
                            <path d="M12 20 L28 20 M20 12 L20 28" stroke="#8b1a1a" stroke-width="2" />
                        </svg>
                        <span data-i18n="company_name">O.N.Precision</span>
                    </div>
                    <address class="works-cta-address">
                        <p data-i18n="company_address">?399-0428 ??????????1105??8005</p>
                        <p>????:08~17?(??) FAX:0266-23-2776</p>
                    </address>
                </div>

                <!-- Contact Button -->
                <div class="works-cta-contact">
                    <a href="./contact.html" class="works-contact-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                            <path d="M22 6l-10 7L2 6" />
                        </svg>
                        <span data-i18n="contact_button">??????</span>
                    </a>
                </div>

                <!-- Phone Number -->
                <div class="works-cta-phone">
                    <a href="tel:(+84) 907 692 367" class="works-phone-link">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                        </svg>
                        <span class="works-phone-number">(+84) 907 692 367</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================
         Footer Navigation
         ======================== -->
    <nav class="works-footer-nav">
        <div class="container">
            <ul class="works-footer-list">
                <li><a href="./index.html" data-i18n="nav_home">HOME</a></li>
                <li><a href="./works.html" data-i18n="nav_works">????</a></li>
                <li><a href="./products.html" data-i18n="nav_products">????</a></li>
                <li><a href="./equipment.html" data-i18n="nav_equipment">????</a></li>
                <li><a href="./company.html" data-i18n="nav_about">????</a></li>
                <li><a href="#" data-i18n="nav_quality">??�????</a></li>
                <li><a href="./recruit.html" data-i18n="nav_recruit">????</a></li>
                <li><a href="./news.html" data-i18n="nav_news">????</a></li>
            </ul>
        </div>
    </nav>

    <!-- ========================
         Footer
         ======================== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p class="copyright">Copyright(C) O.N.Precision Co.,Ltd All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="?????????">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 15l-6-6-6 6" />
        </svg>
    </button>

    <!-- JavaScript Files -->
    <script src="./assets/js/translations.js"></script>
    <script src="./assets/js/main.js"></script>

    <!-- Equipment Dynamic Loading Script -->
    <script>
        // Variables
        let departments = [];
        let equipment = [];
        let currentDept = 'all';
        let currentImages = [];
        let currentImageIndex = 0;

        // Get language (same key as main.js: 'preferred_language')
        function getLang() {
            return localStorage.getItem('preferred_language') || 'ja';
        }

        // Load departments from API
        async function loadDepartments() {
            try {
                const res = await fetch('/api/departments?active=true');
                const data = await res.json();
                if (data.success) {
                    departments = data.data;
                    renderDepartmentTabs();
                }
            } catch (e) {
                console.error('Error loading departments:', e);
            }
        }

        // Get translation
        function t(key) {
            const lang = getLang();
            return translations[lang]?.[key] || translations['ja']?.[key] || key;
        }

        // Render department tabs
        function renderDepartmentTabs() {
            const container = document.getElementById('departmentTabs');
            if (!container) return;

            const lang = getLang();
            console.log('Current language:', lang); // Debug

            // Get translated "All" text
            const allText = lang === 'ja' ? 'すべて' : (lang === 'en' ? 'All' : 'Tất cả');

            let html = `<button class="dept-tab ${currentDept === 'all' ? 'active' : ''}" onclick="filterDept('all')">
                ${allText}
            </button>`;

            departments.forEach(d => {
                // Get department name based on language with proper fallback
                let name;
                if (lang === 'ja') {
                    name = d.name_ja || d.name_en || d.name_vi;
                } else if (lang === 'en') {
                    name = d.name_en || d.name_ja || d.name_vi;
                } else {
                    name = d.name_vi || d.name_ja || d.name_en;
                }

                html += `<button class="dept-tab ${currentDept === d.code ? 'active' : ''}" onclick="filterDept('${d.code}')" style="border-color:${d.color || '#e5e7eb'};">
                    ${d.icon || ''} ${name}
                </button>`;
            });

            container.innerHTML = html;
        }

        // Load equipment from API
        async function loadEquipment() {
            try {
                const res = await fetch('/api/equipment');
                const data = await res.json();
                if (data.success) {
                    equipment = data.data;
                    renderEquipmentTable();
                }
            } catch (e) {
                console.error('Error loading equipment:', e);
            }
        }

        // Filter by department
        function filterDept(deptCode) {
            currentDept = deptCode;
            renderDepartmentTabs();
            renderEquipmentTable();
        }

        // Render equipment table
        function renderEquipmentTable() {
            const tbody = document.getElementById('equipmentTableBody');
            if (!tbody) return;

            const lang = getLang();
            let filtered = equipment;

            if (currentDept !== 'all') {
                filtered = equipment.filter(e => e.department_code === currentDept);
            }

            if (filtered.length === 0) {
                const emptyMsg = lang === 'ja' ? '設備がありません' : (lang === 'en' ? 'No equipment found' : 'Không có thiết bị nào');
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;color:#6b7280;">${emptyMsg}</td></tr>`;
                return;
            }

            tbody.innerHTML = filtered.map(e => {
                // Get name based on language
                const name = lang === 'ja' ? e.name_ja : (lang === 'en' ? (e.name_en || e.name_ja) : (e.name_vi || e.name_ja));

                // Get specs based on language
                const specs = lang === 'ja' ? e.specs_ja : (lang === 'en' ? (e.specs_en || e.specs_ja) : (e.specs_vi || e.specs_ja)) || '-';

                // Get department name based on language
                const dept = departments.find(d => d.id === e.department_id);
                const deptName = dept ? (lang === 'ja' ? dept.name_ja : (lang === 'en' ? (dept.name_en || dept.name_ja) : (dept.name_vi || dept.name_ja))) : '';

                const hasImages = e.images && (typeof e.images === 'string' ? JSON.parse(e.images).length > 0 : e.images.length > 0);
                const imagesArr = typeof e.images === 'string' ? JSON.parse(e.images) : (e.images || []);
                const thumbUrl = e.image || (imagesArr.length > 0 ? imagesArr[0] : '/assets/images/equipment/default.png');

                return `<tr onclick="openLightbox(${e.id})" style="cursor:${hasImages ? 'pointer' : 'default'}">
                    <td>
                        <div style="display:flex;align-items:center;gap:0.75rem;">
                            <img src="${thumbUrl}" alt="" style="width:50px;height:50px;border-radius:8px;object-fit:cover;background:#f3f4f6;">
                            <div>
                                <div style="font-weight:500;">${name}</div>
                                <span style="font-size:0.75rem;padding:0.2rem 0.5rem;border-radius:4px;background:${dept?.color || '#e5e7eb'}22;color:${dept?.color || '#374151'};">${dept?.icon || ''} ${deptName}</span>
                            </div>
                        </div>
                    </td>
                    <td>${e.brand || '-'} ${e.model || ''}</td>
                    <td>${specs}</td>
                    <td>${e.quantity || 1}</td>
                </tr>`;
            }).join('');
        }

        // Open lightbox
        function openLightbox(equipmentId) {
            const eq = equipment.find(e => e.id === equipmentId);
            const imagesArr = typeof eq.images === 'string' ? JSON.parse(eq.images) : (eq.images || []);
            if (imagesArr.length === 0) return;

            currentImages = imagesArr.map(url => ({ url }));
            currentImageIndex = 0;

            const lang = getLang();
            const name = lang === 'ja' ? eq.name_ja : (lang === 'en' ? eq.name_en : eq.name_vi) || eq.name_ja;

            document.getElementById('lightboxTitle').textContent = name;
            document.getElementById('lightboxDesc').textContent = `${eq.maker || ''} ${eq.model || ''}`;

            updateLightboxImage();
            renderThumbnails();

            document.getElementById('lightboxOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function updateLightboxImage() {
            if (currentImages.length === 0) return;
            const img = currentImages[currentImageIndex];
            const imgUrl = typeof img === 'string' ? img : img.url;
            document.getElementById('lightboxImage').src = imgUrl;

            // Update active thumbnail
            document.querySelectorAll('.lightbox-thumb').forEach((t, i) => {
                t.classList.toggle('active', i === currentImageIndex);
            });
        }

        function renderThumbnails() {
            const container = document.getElementById('lightboxThumbnails');
            container.innerHTML = currentImages.map((img, i) => {
                const imgUrl = typeof img === 'string' ? img : img.url;
                return `<img class="lightbox-thumb ${i === 0 ? 'active' : ''}" src="${imgUrl}" alt="" onclick="goToImage(${i})">`;
            }).join('');
        }

        // Go to specific image
        function goToImage(index) {
            currentImageIndex = index;
            updateLightboxImage();
        }

        // Navigate images
        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % currentImages.length;
            updateLightboxImage();
        }

        function prevImage() {
            currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            updateLightboxImage();
        }

        // Close lightbox
        function closeLightbox() {
            document.getElementById('lightboxOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadDepartments();
            loadEquipment();

            // Lightbox controls
            document.getElementById('lightboxClose')?.addEventListener('click', closeLightbox);
            document.getElementById('lightboxOverlay')?.addEventListener('click', (e) => {
                if (e.target.id === 'lightboxOverlay') closeLightbox();
            });
            document.getElementById('lightboxNext')?.addEventListener('click', nextImage);
            document.getElementById('lightboxPrev')?.addEventListener('click', prevImage);

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (!document.getElementById('lightboxOverlay')?.classList.contains('active')) return;
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
            });
        });

        // Re-render on language change (event dispatched from main.js on window)
        window.addEventListener('languageChanged', () => {
            renderDepartmentTabs();
            renderEquipmentTable();
        });
    </script>

    <!-- Lightbox Modal HTML -->
    <div class="lightbox-overlay" id="lightboxOverlay">
        <div class="lightbox-content">
            <button class="lightbox-close" id="lightboxClose">&times;</button>
            <div class="lightbox-main">
                <button class="lightbox-nav lightbox-prev" id="lightboxPrev">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6" />
                    </svg>
                </button>
                <div class="lightbox-image-container">
                    <img id="lightboxImage" src="" alt="">
                </div>
                <button class="lightbox-nav lightbox-next" id="lightboxNext">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </button>
            </div>
            <div class="lightbox-info">
                <h3 id="lightboxTitle"></h3>
                <p id="lightboxDesc"></p>
            </div>
            <div class="lightbox-thumbnails" id="lightboxThumbnails"></div>
        </div>
    </div>

    <style>
        /* Department Tabs */
        .department-tabs,
        #departmentTabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .dept-tab {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e5e7eb;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .dept-tab:hover {
            border-color: #8b1a1a;
            color: #8b1a1a;
        }

        .dept-tab.active {
            background: #8b1a1a;
            border-color: #8b1a1a;
            color: #fff;
        }

        /* Lightbox */
        .lightbox-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .lightbox-overlay.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
        }

        .lightbox-main {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .lightbox-nav {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .lightbox-nav svg {
            width: 24px;
            height: 24px;
        }

        .lightbox-image-container img {
            max-width: 70vw;
            max-height: 60vh;
            border-radius: 8px;
        }

        .lightbox-info {
            text-align: center;
            color: #fff;
            margin-top: 1rem;
        }

        .lightbox-info h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .lightbox-info p {
            color: #9ca3af;
        }

        .lightbox-thumbnails {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .lightbox-thumb {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
            cursor: pointer;
            opacity: 0.5;
            border: 2px solid transparent;
        }

        .lightbox-thumb:hover,
        .lightbox-thumb.active {
            opacity: 1;
            border-color: #8b1a1a;
        }

        @media (max-width: 768px) {
            .lightbox-nav {
                display: none;
            }
        }
    </style>
    <script src="./assets/js/modules/seo-manager.js"></script>
</body>

</html>